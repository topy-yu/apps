<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å„¿ç«¥æ‰“å­—åŠ é€Ÿå™¨ - é”®ç›˜å¤§å†’é™©</title>
    <style>
        :root { --primary-color: #4CAF50; --bg-color: #f0f4f8; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        
        /* èœå•ç•Œé¢ */
        #menu { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: 50px; text-align: center; z-index: 100; max-width: 600px; }
        .option-group { margin: 15px 0; text-align: left; }
        select, input, button { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; margin: 5px; }
        button { background: var(--primary-color); color: white; cursor: pointer; border: none; padding: 10px 25px; transition: 0.3s; }
        button:hover { background: #45a049; transform: scale(1.05); }

        /* æ¸¸æˆç”»å¸ƒ */
        #game-container { position: relative; width: 100vw; height: 100vh; background: #2c3e50; display: none; overflow: hidden; }
        .word { position: absolute; color: white; background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 24px; font-weight: bold; border: 2px solid #3498db; transition: transform 0.1s; }
        
        /* å‡»æ¯åŠ¨ç”»æ•ˆæœ */
        .word-hit { animation: hitDestroy 0.6s ease-out forwards; }
        @keyframes hitDestroy {
            0% { transform: scale(1) rotate(0deg); opacity: 1; border-color: #3498db; }
            25% { transform: scale(1.3) rotate(5deg); opacity: 1; border-color: #e74c3c; background: rgba(231, 76, 60, 0.3); }
            50% { transform: scale(1.5) rotate(-5deg); opacity: 0.8; border-color: #f39c12; }
            100% { transform: scale(0.1) rotate(10deg); opacity: 0; }
        }
        
        /* ç²’å­æ•ˆæœ */
        .particle { position: absolute; width: 4px; height: 4px; background: #f39c12; border-radius: 50%; pointer-events: none; }
        .particle-explode { animation: particleExplode var(--duration) ease-out forwards; }
        @keyframes particleExplode {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
        }
        
        /* åˆ†æ•°å¼¹å‡ºåŠ¨ç”» */
        .score-popup { position: absolute; color: #2ecc71; font-size: 20px; font-weight: bold; pointer-events: none; animation: scoreFloat 1s ease-out forwards; }
        @keyframes scoreFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-60px) scale(0.8); opacity: 0; }
        }
        
        /* UIé¢æ¿ */
        #ui-layer { position: absolute; top: 0; width: 100%; padding: 20px; color: white; display: flex; justify-content: space-between; box-sizing: border-box; pointer-events: none; }
        #fullscreen-btn { pointer-events: auto; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5); color: white; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        #fullscreen-btn:hover { background: rgba(255,255,255,0.3); border-color: white; transform: scale(1.05); }
        #input-area { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); text-align: center; }
        #player-input { font-size: 24px; padding: 10px; border-radius: 10px; border: 3px solid #3498db; outline: none; width: 300px; text-align: center; }
    </style>
</head>
<body>

<div id="menu">
    <h2>ğŸš€ é”®ç›˜æ‰“å­—å¤§å†’é™©</h2>
    
    <div class="option-group">
        <label>é€‰æ‹©éš¾åº¦ï¼š</label>
        <select id="difficulty">
            <option value="row1">åŸºæœ¬å­—æ¯ 1 (ä¸­é—´è¡Œ: ASDF...)</option>
            <option value="row2">åŸºæœ¬å­—æ¯ 2 (ä¸Šè¡Œ: QWER...)</option>
            <option value="row3">åŸºæœ¬å­—æ¯ 3 (ä¸‹è¡Œ: ZXCV...)</option>
            <option value="all_rows">å…¨éƒ¨å­—æ¯ (A-Z)</option>
            <option value="pinyin_mix">å¸¸ç”¨æ‹¼éŸ³ (å£°æ¯/éŸµæ¯ç»„åˆ)</option>
            <option value="pinyin_full">æ‰€æœ‰æ‹¼éŸ³ç»„åˆ</option>
            <option value="custom">è‡ªå®šä¹‰é¢˜åº“ (è§ä¸‹æ–¹æ–‡æœ¬æ¡†)</option>
        </select>
    </div>

    <div id="custom-box" class="option-group" style="display:none;">
        <label>è‡ªå®šä¹‰è¯åº“ (ç”¨ç©ºæ ¼æˆ–é€—å·éš”å¼€):</label><br>
        <textarea id="custom-words" style="width:100%; height:60px;">apple banana cherry</textarea>
    </div>

    <div class="option-group">
        <label>ä¸‹è½é€Ÿåº¦ (1-10):</label>
        <input type="number" id="speed" value="2" min="1" max="10">
        <label>æ—¶é—´ (ç§’):</label>
        <input type="number" id="game-time" value="60" min="10">
    </div>

    <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
</div>

<div id="game-container">
    <div id="ui-layer">
        <div>å¾—åˆ†: <span id="score">0</span></div>
        <div>
            <button id="fullscreen-btn" onclick="toggleFullscreen()">ğŸ”² å…¨å±</button>
            <span style="margin-left: 15px;">å‰©ä½™æ—¶é—´: <span id="timer">60</span>s</span>
        </div>
    </div>
    
    <div id="input-area">
        <input type="text" id="player-input" placeholder="åœ¨æ­¤è¾“å…¥æ–‡å­—..." autofocus>
    </div>
</div>

<script>
    // é¢˜åº“å®šä¹‰
    const wordBanks = {
        row1: "asdfghjkl;".split(""),
        row2: "qwertyuiop[]".split(""),
        row3: "zxcvbnm,./".split(""),
        all_rows: "asdfghjkl;qwertyuiop[]zxcvbnm,./".split(""),
        pinyin_mix: ["shang", "zhong", "guo", "hua", "xue", "tian", "ming", "bai", "dui", "qing"],
        pinyin_full: ["a","ai","an","ang","ao","ba","bai","ban","bang","bao","bei","ben","beng","bi","bian","biao","bie","bin","bing","bo","bu","ca","cai","can","cang","cao","ce","cen","ceng","cha","chai","chan","chang","chao","che","chen","cheng","chi","chong","chou","chu","chua","chuai","chuan","chuang","chui","chun","chuo","ci","cong","cou","cu","cuan","cui","cun","cuo","da","dai","dan","dang","dao","de","dei","den","deng","di","dia","dian","diao","die","ding","diu","dong","dou","du","duan","dui","dun","duo","e","en","er","fa","fan","fang","fei","fen","feng","fo","fou","fu","ga","gai","gan","gang","gao","ge","gei","gen","geng","gong","gou","gu","gua","guai","guan","guang","gui","gun","guo","ha","hai","han","hang","hao","he","hei","hen","heng","hong","hou","hu","hua","huai","huan","huang","hui","hun","huo","ji","jia","jian","jiang","jiao","jie","jin","jing","jiong","jiu","ju","juan","jue","jun","ka","kai","kan","kang","kao","ke","ken","keng","kong","kou","ku","kua","kuai","kuan","kuang","kui","kun","kuo","la","lai","lan","lang","lao","le","lei","leng","li","lia","lian","liang","liao","lie","lin","ling","liu","long","lou","lu","luan","lÃ¼","lue","lun","luo","ma","mai","man","mang","mao","me","mei","men","meng","mi","mian","miao","mie","min","ming","miu","mo","mou","mu","na","nai","nan","nang","nao","ne","nei","nen","neng","ni","nian","niang","niao","nie","nin","ning","niu","nong","nou","nu","nuan","nÃ¼","nue","nuo","o","ou","pa","pai","pan","pang","pao","pei","pen","peng","pi","pian","piao","pie","pin","ping","po","pou","pu","qi","qia","qian","qiang","qiao","qie","qin","qing","qiong","qiu","qu","quan","que","qun","ran","rang","rao","re","ren","reng","ri","rong","rou","ru","ruan","rui","run","ruo","sa","sai","san","sang","sao","se","sen","seng","sha","shai","shan","shang","shao","she","shei","shen","sheng","shi","shou","shu","shua","shuai","shuan","shuang","shui","shun","shuo","si","song","sou","su","suan","sui","sun","suo","ta","tai","tan","tang","tao","te","teng","ti","tian","tiao","tie","ting","tong","tou","tu","tuan","tui","tun","tuo","wa","wai","wan","wang","wei","wen","weng","wo","wu","xi","xia","xian","xiang","xiao","xie","xin","xing","xiong","xiu","xu","xuan","xue","xun","ya","yan","yang","yao","ye","yi","yin","ying","yo","yong","you","yu","yuan","yue","yun","za","zai","zan","zang","zao","ze","zei","zen","zeng","zha","zhai","zhan","zhang","zhao","zhe","zhei","zhen","zheng","zhi","zhong","zhou","zhu","zhua","zhuai","zhuan","zhuang","zhui","zhun","zhuo","zi","zong","zou","zu","zuan","zui","zun","zuo"]
    };

    let score = 0;
    let timeLeft = 60;
    let gameInterval, spawnInterval, timerInterval;
    let activeWords = [];
    let speed = 5;

    const difficultySelect = document.getElementById('difficulty');
    difficultySelect.addEventListener('change', () => {
        document.getElementById('custom-box').style.display = difficultySelect.value === 'custom' ? 'block' : 'none';
    });

    function startGame() {
        // åˆå§‹åŒ–è®¾ç½®
        score = 0;
        timeLeft = parseInt(document.getElementById('game-time').value);
        speed = parseInt(document.getElementById('speed').value);
        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = timeLeft;
        
        // è·å–é¢˜ç›®é›†
        let currentBank = [];
        const diff = difficultySelect.value;
        if (diff === 'custom') {
            currentBank = document.getElementById('custom-words').value.split(/[\s,ï¼Œ]+/).filter(w => w.length > 0);
        } else {
            currentBank = wordBanks[diff];
        }

        // åˆ‡æ¢ç•Œé¢
        document.getElementById('menu').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        const inputField = document.getElementById('player-input');
        inputField.value = '';
        inputField.focus();

        // æ¸¸æˆé€»è¾‘å¾ªç¯
        spawnInterval = setInterval(() => spawnWord(currentBank), 2000 - (speed * 100));
		
        // 1. ä¸“é—¨å¤„ç†ç‰©ç†ä¸‹è½çš„å¾ªç¯ (æ¯ 50 æ¯«ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œä¿è¯ä¸æ»‘)
		gameInterval = setInterval(() => {
			updatePhysics();
		}, 50);

		// 2. ä¸“é—¨å¤„ç†å€’è®¡æ—¶çš„å¾ªç¯ (æ¯ 1000 æ¯«ç§’å‡ 1ï¼Œä¿è¯æ—¶é—´å‡†ç¡®)
		timerInterval = setInterval(() => {
			timeLeft--;
			document.getElementById('timer').innerText = timeLeft;
			if (timeLeft <= 0) endGame();
		}, 1000);

        // è¾“å…¥ç›‘å¬
        inputField.oninput = () => {
            const val = inputField.value.trim().toLowerCase();
            const targetIndex = activeWords.findIndex(w => w.text.toLowerCase() === val);
            if (targetIndex !== -1) {
                // å‡»æ¯é€»è¾‘å¢å¼º
                const wordObj = activeWords[targetIndex];
                destroyWord(wordObj, targetIndex);
                inputField.value = '';
            }
        };
    }

    function destroyWord(wordObj, index) {
        const { el, text } = wordObj;
        
        // åˆ›å»ºç²’å­çˆ†ç‚¸æ•ˆæœ
        createParticleExplosion(el);
        
        // åˆ›å»ºåˆ†æ•°å¼¹å‡ºåŠ¨ç”»
        createScorePopup(el, '+10');
        
        // æ·»åŠ å‡»æ¯åŠ¨ç”»
        el.classList.add('word-hit');
        
        // å»¶è¿Ÿåˆ é™¤å…ƒç´ 
        setTimeout(() => {
            if (el.parentNode) {
                el.remove();
            }
        }, 600);
        
        // ç«‹å³ä»æ•°ç»„ä¸­ç§»é™¤ï¼Œé¿å…é‡å¤æ£€æµ‹
        activeWords.splice(index, 1);
        
        // æ›´æ–°åˆ†æ•°
        score += 10;
        document.getElementById('score').innerText = score;
        
        // è¾“å…¥æ¡†é—ªçƒåé¦ˆ
        const inputField = document.getElementById('player-input');
        inputField.style.borderColor = '#2ecc71';
        inputField.style.boxShadow = '0 0 10px rgba(46, 204, 113, 0.5)';
        setTimeout(() => {
            inputField.style.borderColor = '#3498db';
            inputField.style.boxShadow = 'none';
        }, 200);
    }
    
    function createParticleExplosion(wordElement) {
        const rect = wordElement.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        // åˆ›å»º8-12ä¸ªç²’å­
        const particleCount = Math.floor(Math.random() * 5) + 8;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // éšæœºé¢œè‰²
            const colors = ['#f39c12', '#e74c3c', '#2ecc71', '#3498db', '#9b59b6'];
            particle.style.background = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºæ–¹å‘å’Œè·ç¦»
            const angle = (Math.PI * 2 * i) / particleCount + (Math.random() - 0.5) * 0.5;
            const distance = Math.random() * 100 + 50;
            const dx = Math.cos(angle) * distance;
            const dy = Math.sin(angle) * distance;
            const duration = Math.random() * 0.5 + 0.5;
            
            particle.style.left = centerX + 'px';
            particle.style.top = centerY + 'px';
            particle.style.setProperty('--dx', dx + 'px');
            particle.style.setProperty('--dy', dy + 'px');
            particle.style.setProperty('--duration', duration + 's');
            
            document.getElementById('game-container').appendChild(particle);
            
            // å¯åŠ¨åŠ¨ç”»
            requestAnimationFrame(() => {
                particle.classList.add('particle-explode');
            });
            
            // æ¸…ç†ç²’å­
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.remove();
                }
            }, duration * 1000);
        }
    }
    
    function createScorePopup(wordElement, scoreText) {
        const popup = document.createElement('div');
        popup.className = 'score-popup';
        popup.innerText = scoreText;
        
        const rect = wordElement.getBoundingClientRect();
        popup.style.left = (rect.left + rect.width / 2 - 10) + 'px';
        popup.style.top = (rect.top - 10) + 'px';
        
        document.getElementById('game-container').appendChild(popup);
        
        // æ¸…ç†å¼¹å‡ºåŠ¨ç”»
        setTimeout(() => {
            if (popup.parentNode) {
                popup.remove();
            }
        }, 1000);
    }

    function spawnWord(bank) {
        const text = bank[Math.floor(Math.random() * bank.length)];
        const el = document.createElement('div');
        el.className = 'word';
        el.innerText = text;
        
        const x = Math.random() * (window.innerWidth - 100) + 50;
        el.style.left = x + 'px';
        el.style.top = '-50px';
        
        document.getElementById('game-container').appendChild(el);
        activeWords.push({ el, text, y: -50 });
    }

    function updatePhysics() {
        activeWords.forEach((obj, index) => {
            obj.y += speed * 0.5;
            obj.el.style.top = obj.y + 'px';
            
            // è§¦åº•åˆ¤å®š
            if (obj.y > window.innerHeight - 150) {
                obj.el.style.borderColor = 'red';
                // å¯å¢åŠ æ‰£åˆ†é€»è¾‘
            }
            if (obj.y > window.innerHeight) {
                obj.el.remove();
                activeWords.splice(index, 1);
            }
        });
    }

    function toggleFullscreen() {
        const btn = document.getElementById('fullscreen-btn');
        
        if (!document.fullscreenElement) {
            // è¿›å…¥å…¨å±
            document.documentElement.requestFullscreen().then(() => {
                btn.innerHTML = 'ğŸ”³ é€€å‡ºå…¨å±';
            }).catch(() => {
                alert('æ— æ³•è¿›å…¥å…¨å±æ¨¡å¼');
            });
        } else {
            // é€€å‡ºå…¨å±
            document.exitFullscreen().then(() => {
                btn.innerHTML = 'ğŸ”² å…¨å±';
            });
        }
    }

    // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–ï¼ˆç”¨æˆ·æŒ‰ESCé”®é€€å‡ºå…¨å±æ—¶ï¼‰
    document.addEventListener('fullscreenchange', () => {
        const btn = document.getElementById('fullscreen-btn');
        if (!document.fullscreenElement) {
            btn.innerHTML = 'ğŸ”² å…¨å±';
        }
    });

    function endGame() {
        clearInterval(spawnInterval);
        clearInterval(gameInterval);
		clearInterval(timerInterval);
        alert(`æ¸¸æˆç»“æŸï¼æœ€ç»ˆå¾—åˆ†ï¼š${score}`);
        location.reload(); // ç®€å•é‡ç½®
    }
</script>

</body>
</html>